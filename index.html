<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TiffyAI Reward Claim</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
  <script src="https://unpkg.com/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>
  <script src="https://unpkg.com/web3modal@1.9.12/dist/index.js"></script>
  <style>
    body { background: radial-gradient(circle, #000, #111); color: gold; font-family: Segoe UI, sans-serif; text-align: center; padding: 50px; }
    h1 { font-size: 28px; color: #4af0f8; text-shadow: 0 0 10px #4af0f8; }
    .message { font-size: 18px; margin-bottom: 30px; color: #ccc; }
    #claimBtn { padding: 15px 40px; font-size: 20px; font-weight: bold; border: none; border-radius: 15px; background: linear-gradient(90deg, gold, #ffd700, gold); color: black; box-shadow: 0 0 20px gold; cursor: pointer; animation: glow 2s infinite alternate; }
    @keyframes glow { 0% { box-shadow: 0 0 10px #ffd700; } 100% { box-shadow: 0 0 30px #fffacd; } }
    #status { margin-top: 20px; font-size: 16px; color: #00ffcc; }
  </style>
</head>
<body>
  <h1>üéÅ Claim Your TiffyAI Reward!</h1>
  <div class="message">Your treasure unlocked 10 TIFFY tokens. Click below to receive them.</div>
  <button id="claimBtn">Claim Now</button>
  <div id="status"></div>

  <script>
    const contractAddress = "0xE488253DD6B4D31431142F1b7601C96f24Fb7dd5"; // TIFFY Contract
    const ABI = [ 
      {"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"lastClaimed","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"claim","outputs":[],"stateMutability":"payable","type":"function"},
      {"inputs":[],"name":"FIXED_BNB_FEE","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"}
    ];

    const providerOptions = {
      walletconnect: {
        package: window.WalletConnectProvider.default,
        options: { rpc: { 56: "https://bsc-dataseed.binance.org/" }, chainId: 56 }
      }
    };

    const web3Modal = new window.Web3Modal.default({ cacheProvider: false, providerOptions });
    let web3, provider, user, contract, fixedFee;

    async function setup() {
      provider = await web3Modal.connect();
      web3 = new Web3(provider);
      const net = await web3.eth.net.getId();
      if (net !== 56) return alert("Please switch to BSC‚ÄØMainnet.");
      user = (await web3.eth.getAccounts())[0];
      contract = new web3.eth.Contract(ABI, contractAddress);
      fixedFee = await contract.methods.FIXED_BNB_FEE().call();
      document.getElementById("status").innerText = `Fee: ${web3.utils.fromWei(fixedFee)}‚ÄØBNB`;
    }

    async function claimReward() {
      if (!contract) {
        await setup();
        if (!contract) return;
      }

      try {
        document.getElementById("status").innerText = "‚è≥ Waiting for network...";
        await contract.methods.claim()
                              .send({ from: user, value: fixedFee });
        document.getElementById("status").innerText = "‚úÖ Claimed 10‚ÄØTIFFY! Redirecting‚Ä¶";

        localStorage.setItem('tiffyBlueKeysSpent',
          (parseInt(localStorage.getItem('tiffyBlueKeysSpent')||0) + 10)
        );
        localStorage.setItem('tiffyBlueKeys', 0);

        setTimeout(() => window.location.href = "https://tiffyai.github.io/TiffyAI-Users/", 1500);
      } catch (err) {
        if (err.message.includes("Invalid BNB fee")) {
          alert("‚ùå Wrong BNB fee ‚Äì contact support!");
        } else if (err.message.includes("insufficient funds")) {
          alert("‚õΩ Low BNB gas ‚Äì please top up your wallet.");
        } else {
          alert("‚ùå Claim failed: " + err.message);
        }
        document.getElementById("status").innerText = "Claim failed.";
      }
    }

    document.getElementById("claimBtn").onclick = claimReward;
  </script>
</body>
</html>
